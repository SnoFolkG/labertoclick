<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>La Berto's Click</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
    * {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
    }
    
    html {
        touch-action: manipulation;
        height: 100%;
    }
    
    body {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
        transition: background-color 0.3s, color 0.3s;
        -webkit-text-size-adjust: 100%;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        text-align: center;
        background-color: var(--bg);
        color: var(--text);
        display: flex;
        flex-direction: column;
    }

    :root {
        --primary: #6C5CE7;
        --primary-dark: #5649C0;
        --secondary: #00B894;
        --accent: #FD79A8;
        --text: #2D3436;
        --text-light: #636E72;
        --bg: #F5F6FA;
        --card-bg: #FFFFFF;
        --border: #DFE6E9;
        --stat-bg: #FFFFFF;
        --reset-btn: #E17055;
        --owned-bg: #F0F3F7;
        --owned-text: #7F8C8D;
        --premium: #FDCB6E;
        --legendary: #E84393;
        --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
        --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
        --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
        --radius-sm: 6px;
        --radius-md: 10px;
        --radius-lg: 14px;
        --radius-xl: 18px;
    }
    
    @media (prefers-color-scheme: dark) {
        :root {
            --primary: #A29BFE;
            --primary-dark: #847BFF;
            --secondary: #55EFC4;
            --accent: #FF9FF3;
            --text: #ECF0F1;
            --text-light: #B2BEC3;
            --bg: #1A1E2C;
            --card-bg: #252A3A;
            --border: #3B4252;
            --stat-bg: #2D3445;
            --reset-btn: #FF7675;
            --owned-bg: #2D3445;
            --owned-text: #7F8C8D;
        }
    }

    .container {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
        padding-bottom: 10px;
        -webkit-overflow-scrolling: touch;
    }
    
    .header {
        background: var(--primary);
        color: white;
        padding: 18px 0;
        position: sticky;
        top: 0;
        z-index: 10;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .header h1 {
        margin: 0;
        font-size: clamp(1.5rem, 6vw, 2rem);
        font-weight: 800;
        letter-spacing: -0.5px;
    }
    
    .tabs {
        display: flex;
        background: var(--card-bg);
        position: sticky;
        top: 0;
        z-index: 9;
        border-bottom: 1px solid var(--border);
    }
    
    .tab {
        flex: 1;
        padding: 14px 5px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.2s ease;
        font-size: clamp(0.8rem, 3vw, 0.95rem);
        color: var(--text-light);
        position: relative;
    }
    
    .tab.active {
        color: var(--primary);
        background-color: rgba(108, 92, 231, 0.1);
    }
    
    .tab.active::after {
        content: '';
        position: absolute;
        bottom: -1px;
        left: 25%;
        right: 25%;
        height: 3px;
        background: var(--primary);
        border-radius: 3px 3px 0 0;
    }
    
    .tab-content {
        display: none;
        padding: 15px;
        flex-grow: 1;
        overflow-y: auto;
    }
    
    .tab-content.active {
        display: block;
        animation: fadeIn 0.3s ease-out;
    }
    
    #clickButton {
        width: clamp(150px, 50vw, 220px);
        height: clamp(150px, 50vw, 220px);
        border-radius: var(--radius-xl);
        background: var(--primary);
        color: white;
        border: none;
        font-size: clamp(1.3rem, 4vw, 1.8rem);
        font-weight: 800;
        cursor: pointer;
        margin: 25px auto;
        box-shadow: var(--shadow-lg);
        transition: transform 0.1s, box-shadow 0.1s;
        animation: pulse 2s infinite;
        -webkit-appearance: none;
        position: relative;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    #clickButton::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(
            to bottom right,
            rgba(255,255,255,0.3) 0%,
            rgba(255,255,255,0) 60%
        );
        transform: rotate(30deg);
    }
    
    #clickButton:active {
        transform: scale(0.95);
        background: var(--primary-dark);
        box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        animation: none;
    }
    
    #score {
        font-size: clamp(2rem, 8vw, 2.5rem);
        font-weight: 800;
        margin: 20px 0;
        color: var(--primary);
        letter-spacing: -1px;
    }
    
    .upgrades-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }
    
    .upgrade {
        background: var(--card-bg);
        border-radius: var(--radius-md);
        padding: 16px;
        box-shadow: var(--shadow-sm);
        text-align: left;
        transition: all 0.2s ease;
        border: 1px solid var(--border);
    }
    
    .upgrade:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
    }
    
    .upgrade.owned {
        background: var(--owned-bg);
        order: 1;
    }
    
    .upgrade.owned .upgrade-name {
        color: var(--owned-text);
    }
    
    .upgrade.owned .upgrade-desc {
        color: var(--owned-text);
    }
    
    .upgrade.owned .upgrade-btn {
        background: var(--owned-bg);
        color: var(--owned-text);
        border: 1px solid var(--owned-text);
    }
    
    .upgrade.premium {
        border-left: 4px solid var(--premium);
    }
    
    .upgrade.special-upgrade {
        border-left: 4px solid var(--accent);
    }
    
    .upgrade.legendary {
        border-left: 4px solid var(--legendary);
        animation: glow 2s infinite alternate;
    }
    
    .upgrade-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
    }
    
    .upgrade-name {
        font-weight: 700;
        font-size: clamp(1rem, 3.5vw, 1.15rem);
        color: var(--primary);
    }
    
    .upgrade-name.premium {
        color: var(--premium);
    }
    
    .upgrade-name.legendary {
        color: var(--legendary);
    }
    
    .upgrade-cost {
        background: var(--accent);
        color: white;
        padding: 4px 10px;
        border-radius: var(--radius-sm);
        font-size: clamp(0.8rem, 3vw, 0.9rem);
        font-weight: bold;
    }
    
    .upgrade-cost.premium {
        background: var(--premium);
        color: var(--text);
    }
    
    .upgrade-cost.legendary {
        background: var(--legendary);
        color: white;
    }
    
    .upgrade-desc {
        color: var(--text-light);
        margin-bottom: 16px;
        font-size: clamp(0.85rem, 3vw, 0.95rem);
        line-height: 1.4;
    }
    
    .upgrade-btn {
        width: 100%;
        padding: 10px;
        border: none;
        border-radius: var(--radius-sm);
        background: var(--primary);
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: clamp(0.9rem, 3vw, 1rem);
        -webkit-appearance: none;
    }
    
    .upgrade-btn:hover:not(:disabled) {
        background: var(--primary-dark);
    }
    
    .upgrade-btn:active:not(:disabled) {
        transform: translateY(1px);
    }
    
    .upgrade-btn:disabled {
        opacity: 0.7;
        cursor: not-allowed;
        transform: none !important;
    }
    
    .upgrade-btn.premium {
        background: var(--premium);
    }
    
    .upgrade-btn.legendary {
        background: var(--legendary);
    }
    
    .stats-container, .settings-container {
        background: var(--card-bg);
        border-radius: var(--radius-md);
        padding: 20px;
        margin-top: 20px;
        border: 1px solid var(--border);
        box-shadow: var(--shadow-sm);
    }
    
    .stat {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid var(--border);
        font-size: clamp(0.9rem, 3vw, 1rem);
    }
    
    .stat:last-child {
        border-bottom: none;
    }
    
    .stat-name {
        font-weight: 500;
        color: var(--text-light);
    }
    
    .stat-value {
        font-weight: 700;
        color: var(--primary);
    }
    
    .click-effect {
        position: absolute;
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.7);
        border-radius: 50%;
        pointer-events: none;
        animation: clickAnimation 0.8s forwards;
        transform: translate(-50%, -50%);
    }
    
    .premium-progress {
        height: 6px;
        background: var(--border);
        border-radius: 3px;
        margin: 15px 0;
        overflow: hidden;
    }
    
    .premium-progress-bar {
        height: 100%;
        background: var(--premium);
        width: 0%;
        transition: width 0.5s ease;
    }
    
    .legendary-progress-bar {
        background: var(--legendary);
    }
    
    .settings-section {
        margin-bottom: 25px;
        padding-bottom: 20px;
        border-bottom: 1px solid var(--border);
    }
    
    .settings-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }
    
    .settings-section h3 {
        margin-top: 0;
        margin-bottom: 15px;
        color: var(--primary);
        font-size: 1.1rem;
    }
    
    .color-options {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin: 15px 0;
        justify-content: center;
    }
    
    .color-option {
        width: 40px;
        height: 40px;
        border-radius: var(--radius-sm);
        cursor: pointer;
        border: 2px solid transparent;
        transition: all 0.2s ease;
        position: relative;
    }
    
    .color-option:hover {
        transform: scale(1.05);
    }
    
    .color-option.selected {
        border: 2px solid var(--primary);
        transform: scale(1.05);
    }
    
    .color-option .price-tag {
        position: absolute;
        bottom: -5px;
        right: -5px;
        background: var(--accent);
        color: white;
        font-size: 10px;
        padding: 2px 5px;
        border-radius: 10px;
        font-weight: bold;
    }
    
    .reset-btn, .cheat-submit {
        padding: 12px;
        border: none;
        border-radius: var(--radius-sm);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        -webkit-appearance: none;
        font-size: 0.95rem;
    }
    
    .reset-btn {
        width: 100%;
        background: var(--reset-btn);
        color: white;
    }
    
    .reset-btn:hover {
        opacity: 0.9;
    }
    
    .reset-btn:active {
        transform: translateY(1px);
    }
    
    .cheat-container {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.7);
        z-index: 100;
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(5px);
    }
    
    .cheat-box {
        background: var(--card-bg);
        padding: 20px;
        border-radius: var(--radius-lg);
        width: 90%;
        max-width: 380px;
        box-shadow: var(--shadow-lg);
        border: 1px solid var(--border);
    }
    
    .cheat-title {
        margin-top: 0;
        color: var(--primary);
        font-size: 1.2rem;
        margin-bottom: 20px;
    }
    
    .cheat-input {
        width: 100%;
        padding: 12px 15px;
        margin: 10px 0 15px;
        border: 2px solid var(--border);
        border-radius: var(--radius-sm);
        font-size: 1.1rem;
        background: var(--bg);
        color: var(--text);
        text-align: center;
        font-weight: 600;
    }
    
    .cheat-buttons {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
        margin-bottom: 15px;
    }
    
    .cheat-button {
        padding: 12px;
        font-size: 1.2rem;
        border: none;
        border-radius: var(--radius-sm);
        background: var(--card-bg);
        color: var(--text);
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .cheat-button:hover {
        background: var(--border);
    }
    
    .cheat-button:active {
        transform: scale(0.95);
        background: var(--primary);
        color: white;
    }
    
    .cheat-actions {
        display: flex;
        gap: 10px;
    }
    
    .cheat-submit {
        flex: 1;
        background: var(--primary);
        color: white;
    }
    
    .cheat-cancel {
        flex: 1;
        background: var(--reset-btn);
        color: white;
    }
    
    .cheat-submit:hover, .cheat-cancel:hover {
        opacity: 0.9;
    }
    
    .cheat-submit:active, .cheat-cancel:active {
        transform: translateY(1px);
    }
    
    .sort-buttons {
        display: flex;
        gap: 8px;
        margin-bottom: 15px;
        overflow-x: auto;
        padding-bottom: 5px;
        scrollbar-width: none;
    }
    
    .sort-buttons::-webkit-scrollbar {
        display: none;
    }
    
    .sort-btn {
        flex: none;
        padding: 8px 12px;
        border: none;
        border-radius: var(--radius-sm);
        background: var(--card-bg);
        color: var(--text);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 0.85rem;
        border: 1px solid var(--border);
        white-space: nowrap;
    }
    
    .sort-btn.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
    }
    
    h2 {
        color: var(--primary);
        margin-top: 0;
        font-size: 1.4rem;
    }
    
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.03); }
        100% { transform: scale(1); }
    }
    
    @keyframes clickAnimation {
        0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
        100% { transform: translate(-50%, -50%) scale(3); opacity: 0; }
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes glow {
        from { box-shadow: 0 0 5px -5px var(--legendary); }
        to { box-shadow: 0 0 10px 2px var(--legendary); }
    }
    
    @media (max-width: 350px) {
        .upgrades-container { grid-template-columns: 1fr; }
        .tab { padding: 12px 3px; font-size: 0.7rem; }
        .color-option { width: 36px; height: 36px; }
        .sort-btn { padding: 8px 10px; font-size: 0.8rem; }
    }
    
    @media (min-width: 768px) {
        .container { max-width: 768px; margin: 0 auto; }
        #clickButton { width: 220px; height: 220px; font-size: 2rem; }
        .upgrades-container { grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); }
    }
</style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>La Berto's Click</h1>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="clicker">Кликер</div>
            <div class="tab" data-tab="upgrades">Улучшения</div>
            <div class="tab" data-tab="settings">Настройки</div>
        </div>
        
        <div class="tab-content active" id="clicker-tab">
            <div id="score">0 очков</div>
            <button id="clickButton">КЛИК!</button>
            <div class="stats-container">
                <div class="stat">
                    <span class="stat-name">Очков за клик:</span>
                    <span class="stat-value" id="perClickStat">1</span>
                </div>
                <div class="stat">
                    <span class="stat-name">Очков в секунду:</span>
                    <span class="stat-value" id="perSecondStat">0</span>
                </div>
                <div class="stat">
                    <span class="stat-name">Множитель очков:</span>
                    <span class="stat-value" id="multiplierStat">1x</span>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="upgrades-tab">
            <h2>Улучшения</h2>
            <div class="sort-buttons">
                <button class="sort-btn active" data-sort="expensive">Дороже</button>
                <button class="sort-btn" data-sort="cheap">Дешевле</button>
                <button class="sort-btn" data-sort="available">Доступные</button>
            </div>
            <div class="upgrades-container" id="upgradesList"></div>
        </div>
        
        <div class="tab-content" id="settings-tab">
            <h2>Настройки</h2>
            <div class="settings-container" id="settingsContent"></div>
        </div>
    </div>

    <div class="cheat-container" id="cheatContainer">
        <div class="cheat-box">
            <h3 class="cheat-title">Введите промокод</h3>
            <input type="text" class="cheat-input" id="cheatInput" placeholder="Промокод" readonly>
            <div class="cheat-buttons">
                <button class="cheat-button" data-number="1">1</button>
                <button class="cheat-button" data-number="2">2</button>
                <button class="cheat-button" data-number="3">3</button>
                <button class="cheat-button" data-number="4">4</button>
                <button class="cheat-button" data-number="5">5</button>
                <button class="cheat-button" data-number="6">6</button>
                <button class="cheat-button" data-number="7">7</button>
                <button class="cheat-button" data-number="8">8</button>
                <button class="cheat-button" data-number="9">9</button>
                <button class="cheat-button" data-number="0">0</button>
                <button class="cheat-button" id="cheatBackspace">⌫</button>
                <button class="cheat-button" id="cheatClear">C</button>
            </div>
            <div class="cheat-actions">
                <button class="cheat-submit" id="cheatSubmit">Применить</button>
                <button class="cheat-cancel" id="cheatCancel">Отмена</button>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();
        
        const translations = {
            ru: {
                clicker: "Кликер", upgrades: "Улучшения", settings: "Настройки",
                clickButton: "КЛИК!", points: "очков", upgrade: "Улучшить", bought: "Куплено", activated: "Активировано!",
                perClick: "Очков за клик:", perSecond: "Очков в секунду:", multiplier: "Множитель очков:",
                settingsTitle: "Настройки", colorTheme: "Цветовая тема",
                gameManagement: "Управление игрой", resetProgress: "Сбросить прогресс", enterCheat: "Ввести промокод",
                cheatSuccess: "Промокод активирован!", cheatInvalid: "Неверный промокод", cheatUsed: "Этот промокод уже использован",
                resetConfirm: "Вы уверены, что хотите сбросить весь прогресс? Это действие нельзя отменить.",
                resetSuccess: "Прогресс успешно сброшен!",
                usedPromos: "Использованные промокоды", noPromosUsed: "Промокоды не использовались",
                expensive: "Дороже", cheap: "Дешевле", available: "Доступные"
            }
        };
        
        const colorSchemes = {
            purple: { primary: '#6C5CE7', secondary: '#00B894', accent: '#FD79A8', price: 1000 },
            blue: { primary: '#0984E3', secondary: '#00CEC9', accent: '#FF7675', price: 1000 },
            green: { primary: '#00B894', secondary: '#55EFC4', accent: '#FD79A8', price: 1000 },
            red: { primary: '#D63031', secondary: '#E84393', accent: '#FDCB6E', price: 1000 },
            orange: { primary: '#E17055', secondary: '#FDCB6E', accent: '#A29BFE', price: 1000 },
            pink: { primary: '#E84393', secondary: '#FD79A8', accent: '#FDCB6E', price: 1000 },
            teal: { primary: '#00CEA9', secondary: '#55EFC4', accent: '#A29BFE', price: 1000 },
            indigo: { primary: '#5D5FEF', secondary: '#847BFF', accent: '#FF9FF3', price: 1000 },
            gold: { primary: '#FFD700', secondary: '#FFA500', accent: '#FF6347', price: 5000 },
            emerald: { primary: '#2ECC71', secondary: '#1ABC9C', accent: '#3498DB', price: 5000 },
            ruby: { primary: '#E74C3C', secondary: '#C0392B', accent: '#9B59B6', price: 5000 },
            sapphire: { primary: '#3498DB', secondary: '#2980B9', accent: '#2ECC71', price: 5000 },
            amethyst: { primary: '#9B59B6', secondary: '#8E44AD', accent: '#E74C3C', price: 5000 },
            midnight: { primary: '#2C3E50', secondary: '#34495E', accent: '#7F8C8D', price: 5000 }
        };
        
        const cheats = {
            '8456': { 
                name: "Секретное улучшение", 
                used: false, 
                effect: () => { 
                    gameState.upgrades.secretUpgrade1 = { owned: true };
                    gameState.globalMultiplier *= 1.5;
                } 
            },
            '1992': {
                name: "Секретное улучшение 2",
                used: false,
                effect: () => {
                    gameState.upgrades.secretUpgrade2 = { owned: true };
                    gameState.autoClickPower *= 2;
                }
            },
            '4321': {
                name: "Мощный удар",
                used: false,
                effect: () => {
                    gameState.clickPower *= 2;
                }
            },
            '7777': {
                name: "Автокликер+",
                used: false,
                effect: () => {
                    gameState.autoClickers += 5;
                }
            },
            '9999': {
                name: "Чит-код",
                used: false,
                effect: () => {
                    gameState.score += 1000000;
                    gameState.totalPoints += 1000000;
                }
            }
        };
        
        let gameState = {
            score: 0, totalClicks: 0, clickPower: 1, autoClickers: 0, autoClickPower: 1,
            globalMultiplier: 1, colorScheme: 'purple', language: 'ru',
            upgrades: {
                clickPower1: { owned: false }, clickPower2: { owned: false }, clickPower3: { owned: false },
                clickPower4: { owned: false }, clickPower5: { owned: false },
                autoClicker1: { owned: false }, autoClicker2: { owned: false }, autoClicker3: { owned: false },
                autoClicker4: { owned: false }, autoClicker5: { owned: false },
                secretUpgrade1: { owned: false }, secretUpgrade2: { owned: false }
            },
            usedPromoCodes: [],
            unlockedColors: ['purple'],
            totalPoints: 0
        };
        
        const upgrades = {
            clickPower1: { cost: 100, effect: () => { gameState.clickPower += 1; }, type: 'click' },
            clickPower2: { cost: 500, effect: () => { gameState.clickPower *= 2; }, type: 'click' },
            clickPower3: { cost: 2500, effect: () => { gameState.clickPower *= 3; }, type: 'click' },
            clickPower4: { cost: 10000, effect: () => { gameState.clickPower *= 5; }, type: 'click' },
            clickPower5: { cost: 50, effect: () => { gameState.clickPower *= 10; }, type: 'click' },
            autoClicker1: { cost: 250, effect: () => { gameState.autoClickers += 1; }, type: 'auto' },
            autoClicker2: { cost: 1250, effect: () => { gameState.autoClickers += 2; }, type: 'auto' },
            autoClicker3: { cost: 6250, effect: () => { gameState.autoClickers += 5; }, type: 'auto' },
            autoClicker4: { cost: 25000, effect: () => { gameState.autoClickers += 10; }, type: 'auto' },
            autoClicker5: { cost: 100000, effect: () => { gameState.autoClickers += 20; }, type: 'auto' }
        };
        
        const DOM = {
            score: document.getElementById('score'),
            clickButton: document.getElementById('clickButton'),
            upgradesList: document.getElementById('upgradesList'),
            settingsContent: document.getElementById('settingsContent'),
            cheatContainer: document.getElementById('cheatContainer'),
            cheatInput: document.getElementById('cheatInput'),
            cheatSubmit: document.getElementById('cheatSubmit'),
            cheatCancel: document.getElementById('cheatCancel'),
            cheatBackspace: document.getElementById('cheatBackspace'),
            cheatClear: document.getElementById('cheatClear')
        };
        
        function initGame() {
            loadGame();
            setupEventListeners();
            renderAll();
            startGameLoop();
            
            if (tg && tg.MainButton) {
                tg.MainButton.setText("Закрыть игру");
                tg.MainButton.show();
                tg.MainButton.onClick(() => { saveGame(); tg.close(); });
            }
        }
        
        function setupEventListeners() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab + '-tab').classList.add('active');
                });
            });
            
            document.querySelectorAll('.sort-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    renderUpgrades(btn.dataset.sort);
                });
            });
            
            DOM.clickButton.addEventListener('click', handleClick);
            
            document.querySelectorAll('.cheat-button[data-number]').forEach(btn => {
                btn.addEventListener('click', () => {
                    DOM.cheatInput.value += btn.dataset.number;
                });
            });
            
            DOM.cheatBackspace.addEventListener('click', () => {
                DOM.cheatInput.value = DOM.cheatInput.value.slice(0, -1);
            });
            
            DOM.cheatClear.addEventListener('click', () => {
                DOM.cheatInput.value = '';
            });
            
            DOM.cheatSubmit.addEventListener('click', () => {
                applyCheat(DOM.cheatInput.value);
            });
            
            DOM.cheatCancel.addEventListener('click', hideCheatInput);
        }
        
        function startGameLoop() {
            setInterval(() => {
                if (gameState.autoClickers > 0) {
                    const points = Math.round(gameState.autoClickers * gameState.autoClickPower * gameState.globalMultiplier);
                    gameState.score += points;
                    gameState.totalPoints += points;
                    updateUI();
                }
            }, 1000);
            
            setInterval(saveGame, 10000);
        }
        
        function handleClick(e) {
            const clickEffect = document.createElement('div');
            clickEffect.className = 'click-effect';
            clickEffect.style.left = e.clientX + 'px';
            clickEffect.style.top = e.clientY + 'px';
            clickEffect.style.background = colorSchemes[gameState.colorScheme].accent;
            document.body.appendChild(clickEffect);
            
            setTimeout(() => {
                clickEffect.remove();
            }, 800);
            
            const isCritical = Math.random() < 0.1;
            const multiplier = isCritical ? 5 * gameState.globalMultiplier : gameState.globalMultiplier;
            
            const points = Math.round(gameState.clickPower * multiplier);
            gameState.score += points;
            gameState.totalPoints += points;
            gameState.totalClicks++;
            
            if (isCritical) {
                DOM.clickButton.style.animation = 'none';
                void DOM.clickButton.offsetWidth; // Trigger reflow
                DOM.clickButton.style.animation = 'pulse 0.3s';
                setTimeout(() => {
                    DOM.clickButton.style.animation = 'pulse 2s infinite';
                }, 300);
            }
            
            updateUI();
        }
        
        function buyUpgrade(id) {
            const upgrade = upgrades[id];
            const cost = parseInt(upgrade.cost);
            
            if (gameState.score >= cost && !gameState.upgrades[id]?.owned) {
                gameState.score -= cost;
                gameState.upgrades[id].owned = true;
                upgrade.effect();
                
                renderUpgrades();
                updateUI();
                saveGame();
            }
        }
        
        function buyColorScheme(scheme) {
            if (gameState.unlockedColors.includes(scheme)) {
                gameState.colorScheme = scheme;
                applyColorScheme();
                renderSettings();
                saveGame();
            } else if (gameState.score >= colorSchemes[scheme].price) {
                gameState.score -= colorSchemes[scheme].price;
                gameState.unlockedColors.push(scheme);
                gameState.colorScheme = scheme;
                applyColorScheme();
                renderSettings();
                saveGame();
            }
        }
        
        function updateUI() {
            const t = translations[gameState.language];
            
            const formatNumber = (num) => {
                return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            };
            
            DOM.score.textContent = formatNumber(Math.floor(gameState.score)) + ' ' + t.points;
            
            document.getElementById('perClickStat').textContent = formatNumber(Math.round(gameState.clickPower * gameState.globalMultiplier));
            document.getElementById('perSecondStat').textContent = formatNumber(Math.round(gameState.autoClickers * gameState.autoClickPower * gameState.globalMultiplier));
            document.getElementById('multiplierStat').textContent = gameState.globalMultiplier.toFixed(1) + 'x';
        }
        
        function renderUpgrades(sortType = 'expensive') {
            const t = translations[gameState.language];
            let html = '';
            
            const regularUpgrades = [
                {
                    id: 'clickPower1', name: 'Усиленный палец', cost: 100, 
                    desc: '+1 очко за каждый клик', owned: gameState.upgrades.clickPower1.owned, type: 'click'
                },
                {
                    id: 'clickPower2', name: 'Золотой палец', cost: 500, 
                    desc: 'Удваивает очки за клик', owned: gameState.upgrades.clickPower2.owned, type: 'click'
                },
                {
                    id: 'clickPower3', name: 'Платиновый палец', cost: 2500, 
                    desc: 'Утраивает очки за клик', owned: gameState.upgrades.clickPower3.owned, type: 'click'
                },
                {
                    id: 'clickPower4', name: 'Алмазный палец', cost: 10000, 
                    desc: 'Увеличивает очки за клик в 5 раз', owned: gameState.upgrades.clickPower4.owned, type: 'click'
                },
                {
                    id: 'clickPower5', name: 'Легендарный палец', cost: 50000, 
                    desc: 'Увеличивает очки за клик в 10 раз', owned: gameState.upgrades.clickPower5.owned, type: 'click'
                },
                {
                    id: 'autoClicker1', name: 'Автокликер I', cost: 250, 
                    desc: 'Автоматически кликает 1 раз в секунду', owned: gameState.upgrades.autoClicker1.owned, type: 'auto'
                },
                {
                    id: 'autoClicker2', name: 'Автокликер II', cost: 1250, 
                    desc: 'Автоматически кликает 2 раза в секунду', owned: gameState.upgrades.autoClicker2.owned, type: 'auto'
                },
                {
                    id: 'autoClicker3', name: 'Автокликер III', cost: 6250, 
                    desc: 'Автоматически кликает 5 раз в секунду', owned: gameState.upgrades.autoClicker3.owned, type: 'auto'
                },
                {
                    id: 'autoClicker4', name: 'Автокликер IV', cost: 25000, 
                    desc: 'Автоматически кликает 10 раз в секунду', owned: gameState.upgrades.autoClicker4.owned, type: 'auto'
                },
                {
                    id: 'autoClicker5', name: 'Автокликер V', cost: 100000, 
                    desc: 'Автоматически кликает 20 раз в секунду', owned: gameState.upgrades.autoClicker5.owned, type: 'auto'
                }
            ];
            
            const specialUpgrades = [];
            if (gameState.upgrades.secretUpgrade1.owned) {
                specialUpgrades.push({
                    id: 'secretUpgrade1', name: 'Секретное улучшение', cost: 'Промокод', 
                    desc: 'Увеличивает множитель очков на 50%', owned: true, type: 'special'
                });
            }
            if (gameState.upgrades.secretUpgrade2.owned) {
                specialUpgrades.push({
                    id: 'secretUpgrade2', name: 'Секретное улучшение 2', cost: 'Промокод', 
                    desc: 'Удваивает силу автокликеров', owned: true, type: 'special'
                });
            }
            
            // Filter upgrades based on sort type
            let filteredUpgrades = [...regularUpgrades, ...specialUpgrades];
            
            if (sortType === 'available') {
                filteredUpgrades = filteredUpgrades.filter(up => !up.owned);
            }
            
            // Sort upgrades
            if (sortType === 'expensive') {
                filteredUpgrades.sort((a, b) => b.cost - a.cost);
            } else if (sortType === 'cheap') {
                filteredUpgrades.sort((a, b) => a.cost - b.cost);
            } else if (sortType === 'available') {
                filteredUpgrades.sort((a, b) => a.cost - b.cost);
            }
            
            filteredUpgrades.forEach(up => {
                const costText = typeof up.cost === 'number' ? up.cost.toLocaleString() : up.cost;
                
                if (up.owned) {
                    html += `
                        <div class="upgrade owned">
                            <div class="upgrade-header"><span class="upgrade-name">${up.name}</span><span class="upgrade-cost">${t.bought}</span></div>
                            <div class="upgrade-desc">${up.desc}</div>
                            <button class="upgrade-btn" disabled>${t.bought}</button>
                        </div>
                    `;
                } else {
                    const canBuy = typeof up.cost === 'number' ? gameState.score >= up.cost : false;
                    const isSpecial = up.type === 'special';
                    
                    html += `
                        <div class="upgrade ${isSpecial ? 'special-upgrade' : ''}">
                            <div class="upgrade-header">
                                <span class="upgrade-name">${up.name}</span>
                                <span class="upgrade-cost">${costText}</span>
                            </div>
                            <div class="upgrade-desc">${up.desc}</div>
                            <button class="upgrade-btn" id="${up.id}" onclick="buyUpgrade('${up.id}')" ${canBuy ? '' : 'disabled'}>
                                ${t.upgrade}
                            </button>
                        </div>
                    `;
                }
            });

            DOM.upgradesList.innerHTML = html;
        }

        function renderSettings() {
            const t = translations[gameState.language];
            
            let html = `
                <div class="settings-section">
                    <h3>${t.colorTheme}</h3>
                    <div class="color-options">
            `;
            
            Object.keys(colorSchemes).forEach(scheme => {
                const isUnlocked = gameState.unlockedColors.includes(scheme);
                const isSelected = gameState.colorScheme === scheme;
                
                html += `
                    <div class="color-option ${isSelected ? 'selected' : ''}" 
                          style="background: ${colorSchemes[scheme].primary}"
                          onclick="buyColorScheme('${scheme}')">
                        ${!isUnlocked ? '<span class="price-tag">' + colorSchemes[scheme].price + '</span>' : ''}
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
                <div class="settings-section">
                    <h3>${t.gameManagement}</h3>
                    <button class="reset-btn" onclick="resetProgress()">${t.resetProgress}</button>
                    <button class="reset-btn" onclick="showCheatInput()" style="margin-top: 10px; background: var(--primary);">
                        ${t.enterCheat}
                    </button>
                </div>
            `;
            
            if (gameState.usedPromoCodes.length > 0) {
                html += `
                    <div class="settings-section">
                        <h4>${t.usedPromos}</h4>
                        <div style="text-align: left;">
                            ${gameState.usedPromoCodes.map(code => 
                                '<div>• ' + code + ' - ' + (cheats[code]?.name || 'Бонус') + '</div>'
                            ).join('')}
                        </div>
                    </div>
                `;
            }
            
            DOM.settingsContent.innerHTML = html;
        }

        function renderAll() {
            updateUI();
            renderUpgrades();
            renderSettings();
            applyColorScheme();
        }

        function applyColorScheme() {
            const scheme = colorSchemes[gameState.colorScheme];
            document.documentElement.style.setProperty('--primary', scheme.primary);
            document.documentElement.style.setProperty('--primary-dark', shadeColor(scheme.primary, -20));
            document.documentElement.style.setProperty('--secondary', scheme.secondary);
            document.documentElement.style.setProperty('--accent', scheme.accent);
            
            // Update click button color
            DOM.clickButton.style.background = scheme.primary;
        }
        
        function shadeColor(color, percent) {
            let R = parseInt(color.substring(1,3), 16);
            let G = parseInt(color.substring(3,5), 16);
            let B = parseInt(color.substring(5,7), 16);

            R = parseInt(R * (100 + percent) / 100);
            G = parseInt(G * (100 + percent) / 100);
            B = parseInt(B * (100 + percent) / 100);

            R = (R<255)?R:255;  
            G = (G<255)?G:255;  
            B = (B<255)?B:255;  

            R = Math.round(R);
            G = Math.round(G);
            B = Math.round(B);

            const RR = ((R.toString(16).length==1)?"0"+R.toString(16):R.toString(16));
            const GG = ((G.toString(16).length==1)?"0"+G.toString(16):G.toString(16));
            const BB = ((B.toString(16).length==1)?"0"+B.toString(16):B.toString(16));

            return "#"+RR+GG+BB;
        }

        function showCheatInput() {
            DOM.cheatContainer.style.display = 'flex';
            DOM.cheatInput.value = '';
        }

        function hideCheatInput() {
            DOM.cheatContainer.style.display = 'none';
        }

        function applyCheat(code) {
            const t = translations[gameState.language];
            
            if (cheats[code]) {
                if (cheats[code].used) {
                    alert(t.cheatUsed);
                } else {
                    cheats[code].used = true;
                    cheats[code].effect();
                    gameState.usedPromoCodes.push(code);
                    alert(t.cheatSuccess + '\nБонус: ' + cheats[code].name);
                    renderAll();
                    saveGame();
                }
            } else {
                alert(t.cheatInvalid);
            }
            
            hideCheatInput();
        }

        function resetProgress() {
            const t = translations[gameState.language];
            
            if (confirm(t.resetConfirm)) {
                gameState = {
                    score: 0, totalClicks: 0, clickPower: 1, autoClickers: 0, autoClickPower: 1,
                    globalMultiplier: 1, colorScheme: 'purple', language: 'ru',
                    upgrades: {
                        clickPower1: { owned: false }, clickPower2: { owned: false }, clickPower3: { owned: false },
                        clickPower4: { owned: false }, clickPower5: { owned: false },
                        autoClicker1: { owned: false }, autoClicker2: { owned: false }, autoClicker3: { owned: false },
                        autoClicker4: { owned: false }, autoClicker5: { owned: false },
                        secretUpgrade1: { owned: false }, secretUpgrade2: { owned: false }
                    },
                    usedPromoCodes: [],
                    unlockedColors: ['purple'],
                    totalPoints: 0
                };
                
                Object.keys(cheats).forEach(code => {
                    cheats[code].used = false;
                });
                
                renderAll();
                saveGame();
                alert(t.resetSuccess);
            }
        }

        function saveGame() {
            localStorage.setItem('laBertosClick', JSON.stringify(gameState));
        }

        function loadGame() {
            const saved = localStorage.getItem('laBertosClick');
            if (saved) {
                const loaded = JSON.parse(saved);
                
                gameState = {
                    ...gameState,
                    ...loaded,
                    upgrades: {
                        ...gameState.upgrades,
                        ...(loaded.upgrades || {})
                    },
                    usedPromoCodes: loaded.usedPromoCodes || [],
                    unlockedColors: loaded.unlockedColors || ['purple'],
                    totalPoints: loaded.totalPoints || 0
                };
                
                if (loaded.usedPromoCodes) {
                    loaded.usedPromoCodes.forEach(code => {
                        if (cheats[code]) {
                            cheats[code].used = true;
                        }
                    });
                }
            }
        }

        window.onload = initGame;
        window.buyUpgrade = buyUpgrade;
        window.buyColorScheme = buyColorScheme;
        window.resetProgress = resetProgress;
        window.showCheatInput = showCheatInput;
    </script>
</body>
</html>
