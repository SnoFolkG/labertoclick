<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lä Bertō's Click</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html {
            touch-action: manipulation;
            height: 100%;
        }
        
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            transition: background-color 0.3s, color 0.3s;
            -webkit-text-size-adjust: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            text-align: center;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
        }

        :root {
            --primary: #8e44ad;
            --secondary: #9b59b6;
            --accent: #e74c3c;
            --text: #2c3e50;
            --bg: #f9f9f9;
            --premium: #f1c40f;
            --card-bg: #ffffff;
            --border: #e0e0e0;
            --stat-bg: #ffffff;
            --reset-btn: #e74c3c;
        }
        
        @media (prefers-color-scheme: dark) {
            :root {
                --text: #ecf0f1;
                --bg: #121212;
                --card-bg: #1e1e1e;
                --border: #333333;
                --stat-bg: #252525;
                --reset-btn: #c0392b;
            }
        }

        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            padding-bottom: 10px;
            -webkit-overflow-scrolling: touch;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .header h1 {
            margin: 0;
            font-size: clamp(1.5rem, 6vw, 2.2rem);
            font-weight: 700;
            font-style: italic;
            letter-spacing: 1px;
        }
        
        .tabs {
            display: flex;
            background: var(--card-bg);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 9;
        }
        
        .tab {
            flex: 1;
            padding: 12px 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: clamp(0.8rem, 3vw, 1rem);
            color: var(--text);
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
        }
        
        .tab-content {
            display: none;
            padding: 15px;
            flex-grow: 1;
            overflow-y: auto;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }
        
        #clickButton {
            width: clamp(120px, 40vw, 180px);
            height: clamp(120px, 40vw, 180px);
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            font-size: clamp(1rem, 4vw, 1.5rem);
            font-weight: bold;
            cursor: pointer;
            margin: 20px auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: transform 0.1s, box-shadow 0.1s;
            animation: pulse 2s infinite;
            -webkit-appearance: none;
        }
        
        #clickButton:active {
            transform: scale(0.95);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            animation: none;
        }
        
        #score {
            font-size: clamp(1.5rem, 6vw, 1.75rem);
            font-weight: bold;
            margin: 15px 0;
            color: var(--primary);
        }
        
        .upgrades-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }
        
        .upgrade {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            text-align: left;
            transition: all 0.3s;
        }
        
        .upgrade.premium {
            border: 2px solid var(--premium);
            background: linear-gradient(to bottom right, var(--card-bg), rgba(241, 196, 15, 0.1));
        }
        
        .upgrade-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .upgrade-name {
            font-weight: 600;
            font-size: clamp(0.9rem, 3.5vw, 1.1rem);
            color: var(--primary);
        }
        
        .upgrade-name.premium {
            color: var(--premium);
            animation: rainbow 3s infinite;
        }
        
        .upgrade-cost {
            background: var(--accent);
            color: white;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: clamp(0.7rem, 3vw, 0.85rem);
            font-weight: bold;
        }
        
        .upgrade-cost.premium {
            background: var(--premium);
            color: var(--text);
        }
        
        .upgrade-desc {
            color: #666;
            margin-bottom: 12px;
            font-size: clamp(0.75rem, 3vw, 0.85rem);
        }
        
        .upgrade-btn {
            width: 100%;
            padding: 8px;
            border: none;
            border-radius: 5px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: clamp(0.8rem, 3vw, 0.9rem);
            -webkit-appearance: none;
        }
        
        .upgrade-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .stats-container, .settings-container {
            background: var(--stat-bg);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            margin-top: 15px;
        }
        
        .stat {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
            font-size: clamp(0.85rem, 3vw, 1rem);
        }
        
        .stat:last-child {
            border-bottom: none;
        }
        
        .stat-name {
            font-weight: 600;
        }
        
        .stat-value {
            font-weight: bold;
            color: var(--primary);
        }
        
        .click-effect {
            position: absolute;
            width: 30px;
            height: 30px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            pointer-events: none;
            animation: clickAnimation 0.8s forwards;
            transform: translate(-50%, -50%);
        }
        
        .premium-progress {
            height: 5px;
            background: #eee;
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .premium-progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--premium), #f39c12);
            width: 0%;
            transition: width 0.3s;
        }
        
        .settings-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        
        .settings-section:last-child {
            border-bottom: none;
        }
        
        .color-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        
        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: transform 0.2s;
        }
        
        .color-option.selected {
            border: 2px solid var(--text);
            transform: scale(1.1);
        }
        
        .reset-btn, .cheat-submit {
            padding: 8px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            -webkit-appearance: none;
        }
        
        .reset-btn {
            width: 100%;
            background: var(--reset-btn);
            color: white;
            margin-top: 15px;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes clickAnimation {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(3); opacity: 0; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes rainbow {
            0% { color: #ff0000; }
            14% { color: #ff7f00; }
            28% { color: #ffff00; }
            42% { color: #00ff00; }
            57% { color: #0000ff; }
            71% { color: #4b0082; }
            85% { color: #9400d3; }
            100% { color: #ff0000; }
        }
        
        @media (max-width: 350px) {
            .upgrades-container { grid-template-columns: 1fr; }
            .tab { padding: 10px 3px; font-size: 0.7rem; }
        }
        
        @media (min-width: 768px) {
            .container { max-width: 768px; margin: 0 auto; }
            #clickButton { width: 200px; height: 200px; font-size: 1.8rem; }
            .upgrades-container { grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Lä Bertō's Click</h1>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="clicker">Кликер</div>
            <div class="tab" data-tab="upgrades">Улучшения</div>
            <div class="tab" data-tab="stats">Статистика</div>
            <div class="tab" data-tab="settings">Настройки</div>
        </div>
        
        <div class="tab-content active" id="clicker-tab">
            <div id="score">0 очков</div>
            <button id="clickButton">КЛИК!</button>
            <div class="stats-container">
                <div class="stat">
                    <span class="stat-name">Очков за клик:</span>
                    <span class="stat-value" id="perClickStat">1</span>
                </div>
                <div class="stat">
                    <span class="stat-name">Очков в секунду:</span>
                    <span class="stat-value" id="perSecondStat">0</span>
                </div>
                <div class="stat">
                    <span class="stat-name">Множитель очков:</span>
                    <span class="stat-value" id="multiplierStat">1x</span>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="upgrades-tab">
            <h2>Улучшения</h2>
            <div class="upgrades-container" id="upgradesList"></div>
        </div>
        
        <div class="tab-content" id="stats-tab">
            <h2>Статистика</h2>
            <div class="stats-container" id="statsList"></div>
        </div>
        
        <div class="tab-content" id="settings-tab">
            <h2>Настройки</h2>
            <div class="settings-container" id="settingsContent"></div>
        </div>
    </div>

    <script>
        // Инициализация Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();
        
        // Локализация
        const translations = {
            ru: {
                clicker: "Кликер", upgrades: "Улучшения", stats: "Статистика", settings: "Настройки",
                clickButton: "КЛИК!", points: "очков", upgrade: "Улучшить", bought: "Куплено", activated: "Активировано!",
                perClick: "Очков за клик:", perSecond: "Очков в секунду:", multiplier: "Множитель очков:",
                totalPoints: "Всего очков:", totalClicks: "Всего кликов:", pointsFromClicks: "Очков с кликов:",
                pointsFromAuto: "Очков автоматически:", criticalHits: "Критических ударов:", playTime: "Время игры:",
                totalMultiplier: "Общий множитель:", settingsTitle: "Настройки", colorTheme: "Цветовая тема",
                gameManagement: "Управление игрой", resetProgress: "Сбросить прогресс",
                autoSave: "Автосохранение:", never: "Никогда",
                resetConfirm: "Вы уверены, что хотите сбросить весь прогресс? Это действие нельзя отменить.",
                resetSuccess: "Прогресс успешно сброшен!"
            }
        };
        
        // Цветовые схемы
        const colorSchemes = {
            purple: { primary: '#8e44ad', secondary: '#9b59b6', accent: '#e74c3c' },
            blue: { primary: '#3498db', secondary: '#2980b9', accent: '#e74c3c' },
            green: { primary: '#2ecc71', secondary: '#27ae60', accent: '#e74c3c' },
            red: { primary: '#e74c3c', secondary: '#c0392b', accent: '#3498db' },
            orange: { primary: '#e67e22', secondary: '#d35400', accent: '#3498db' },
            pink: { primary: '#e84393', secondary: '#fd79a8', accent: '#3498db' },
            teal: { primary: '#1abc9c', secondary: '#16a085', accent: '#e74c3c' },
            yellow: { primary: '#f1c40f', secondary: '#f39c12', accent: '#e74c3c' },
            indigo: { primary: '#9b59b6', secondary: '#8e44ad', accent: '#e74c3c' },
            cyan: { primary: '#00cec9', secondary: '#0984e3', accent: '#e74c3c' }
        };
        
        // Игровые переменные
        let gameState = {
            score: 0, totalClicks: 0, pointsFromClicks: 0, pointsFromAuto: 0, criticalHits: 0,
            playTime: 0, totalPoints: 0, clickPower: 1, autoClickers: 0, autoClickPower: 1,
            globalMultiplier: 1, colorScheme: 'purple', language: 'ru',
            upgrades: {
                clickPower1: { owned: false }, clickPower2: { owned: false }, clickPower3: { owned: false },
                autoClicker1: { owned: false }, autoClicker2: { owned: false }, autoClicker3: { owned: false },
                clickStorm: { progress: 0 }, criticalHit: { progress: 0 }, goldRush: { progress: 0 }, infinityClick: { progress: 0 }
            }
        };
        
        // Премиум улучшения
        const premiumUpgrades = {
            clickStorm: { cost: 25000, maxProgress: 100, effect: () => { 
                gameState.autoClickPower *= 2; gameState.globalMultiplier *= 1.1; 
            }},
            criticalHit: { cost: 15000, maxProgress: 100, effect: () => { 
                gameState.globalMultiplier *= 1.2; 
            }},
            goldRush: { cost: 50000, maxProgress: 100, effect: () => { 
                gameState.globalMultiplier *= 1.25; 
            }},
            infinityClick: { cost: 100000, maxProgress: 100, effect: () => { 
                gameState.autoClickPower *= 10; gameState.globalMultiplier *= 1.5; 
            }}
        };
        
        // Улучшения
        const upgrades = {
            clickPower1: { cost: 100, effect: () => { gameState.clickPower += 1; } },
            clickPower2: { cost: 500, effect: () => { gameState.clickPower *= 2; } },
            clickPower3: { cost: 2500, effect: () => { gameState.clickPower *= 3; } },
            autoClicker1: { cost: 250, effect: () => { gameState.autoClickers += 1; } },
            autoClicker2: { cost: 1250, effect: () => { gameState.autoClickers += 2; } },
            autoClicker3: { cost: 6250, effect: () => { gameState.autoClickers += 5; } },
            ...premiumUpgrades
        };
        
        // Элементы DOM
        const DOM = {
            score: document.getElementById('score'),
            clickButton: document.getElementById('clickButton'),
            upgradesList: document.getElementById('upgradesList'),
            statsList: document.getElementById('statsList'),
            settingsContent: document.getElementById('settingsContent')
        };
        
        // Инициализация игры
        function initGame() {
            loadGame();
            setupEventListeners();
            renderAll();
            tg.MainButton.setText("Закрыть игру");
            tg.MainButton.show();
            tg.MainButton.onClick(() => { saveGame(); tg.close(); });
        }
        
        // Загрузка/сохранение
        function loadGame() {
            const saved = localStorage.getItem('laBertoClicker');
            if (saved) try {
                Object.assign(gameState, JSON.parse(saved));
                applyColorScheme(gameState.colorScheme);
            } catch(e) { console.error('Load error:', e); }
        }
        
        function saveGame() {
            try {
                localStorage.setItem('laBertoClicker', JSON.stringify(gameState));
                updateLastSaveTime();
            } catch(e) { console.error('Save error:', e); }
        }
        
        function updateLastSaveTime() {
            const el = document.getElementById('lastSave');
            if (el) el.textContent = new Date().toLocaleTimeString('ru-RU');
        }
        
        // Основные функции
        function applyColorScheme(scheme) {
            const colors = colorSchemes[scheme];
            if (!colors) return;
            
            document.documentElement.style.setProperty('--primary', colors.primary);
            document.documentElement.style.setProperty('--secondary', colors.secondary);
            document.documentElement.style.setProperty('--accent', colors.accent);
            
            document.querySelectorAll('.tab.active').forEach(tab => {
                tab.style.borderBottomColor = colors.primary;
                tab.style.color = colors.primary;
            });
            
            gameState.colorScheme = scheme;
            saveGame();
        }
        
        function resetProgress() {
            if (confirm(translations[gameState.language].resetConfirm)) {
                gameState = {
                    ...gameState,
                    score: 0, totalClicks: 0, pointsFromClicks: 0, pointsFromAuto: 0,
                    criticalHits: 0, playTime: 0, totalPoints: 0, clickPower: 1,
                    autoClickers: 0, autoClickPower: 1, globalMultiplier: 1, colorScheme: 'purple',
                    upgrades: {
                        clickPower1: { owned: false }, clickPower2: { owned: false }, clickPower3: { owned: false },
                        autoClicker1: { owned: false }, autoClicker2: { owned: false }, autoClicker3: { owned: false },
                        clickStorm: { progress: 0 }, criticalHit: { progress: 0 }, goldRush: { progress: 0 }, infinityClick: { progress: 0 }
                    }
                };
                
                document.querySelectorAll('.color-option').forEach(opt => 
                    opt.classList.toggle('selected', opt.dataset.color === 'purple'));
                
                applyColorScheme('purple');
                alert(translations[gameState.language].resetSuccess);
            }
        }
        
        // Рендер интерфейса
        function renderAll() {
            renderUpgrades();
            renderStats();
            renderSettings();
            updateUI();
        }
        
        function renderUpgrades() {
            const t = translations[gameState.language];
            DOM.upgradesList.innerHTML = `
                <div class="upgrade">
                    <div class="upgrade-header"><span class="upgrade-name">Усиленный палец</span><span class="upgrade-cost">100</span></div>
                    <div class="upgrade-desc">+1 очко за каждый клик</div>
                    <button class="upgrade-btn" id="clickPower1" ${gameState.upgrades.clickPower1.owned ? 'disabled' : ''}>
                        ${gameState.upgrades.clickPower1.owned ? t.bought : 'Купить'}
                    </button>
                </div>
                <div class="upgrade">
                    <div class="upgrade-header"><span class="upgrade-name">Золотой палец</span><span class="upgrade-cost">500</span></div>
                    <div class="upgrade-desc">Удваивает очки за клик</div>
                    <button class="upgrade-btn" id="clickPower2" ${gameState.upgrades.clickPower2.owned ? 'disabled' : ''}>
                        ${gameState.upgrades.clickPower2.owned ? t.bought : 'Купить'}
                    </button>
                </div>
                <div class="upgrade">
                    <div class="upgrade-header"><span class="upgrade-name">Платиновый палец</span><span class="upgrade-cost">2,500</span></div>
                    <div class="upgrade-desc">Утраивает очки за клик</div>
                    <button class="upgrade-btn" id="clickPower3" ${gameState.upgrades.clickPower3.owned ? 'disabled' : ''}>
                        ${gameState.upgrades.clickPower3.owned ? t.bought : 'Купить'}
                    </button>
                </div>
                <div class="upgrade">
                    <div class="upgrade-header"><span class="upgrade-name">Автокликер I</span><span class="upgrade-cost">250</span></div>
                    <div class="upgrade-desc">Автоматически кликает 1 раз в секунду</div>
                    <button class="upgrade-btn" id="autoClicker1" ${gameState.upgrades.autoClicker1.owned ? 'disabled' : ''}>
                        ${gameState.upgrades.autoClicker1.owned ? t.bought : 'Купить'}
                    </button>
                </div>
                <div class="upgrade">
                    <div class="upgrade-header"><span class="upgrade-name">Автокликер II</span><span class="upgrade-cost">1,250</span></div>
                    <div class="upgrade-desc">Автоматически кликает 2 раза в секунду</div>
                    <button class="upgrade-btn" id="autoClicker2" ${gameState.upgrades.autoClicker2.owned ? 'disabled' : ''}>
                        ${gameState.upgrades.autoClicker2.owned ? t.bought : 'Купить'}
                    </button>
                </div>
                <div class="upgrade">
                    <div class="upgrade-header"><span class="upgrade-name">Автокликер III</span><span class="upgrade-cost">6,250</span></div>
                    <div class="upgrade-desc">Автоматически кликает 5 раз в секунду</div>
                    <button class="upgrade-btn" id="autoClicker3" ${gameState.upgrades.autoClicker3.owned ? 'disabled' : ''}>
                        ${gameState.upgrades.autoClicker3.owned ? t.bought : 'Купить'}
                    </button>
                </div>
                <div class="upgrade premium">
                    <div class="upgrade-header"><span class="upgrade-name premium">Клик-шторм</span><span class="upgrade-cost premium">25,000</span></div>
                    <div class="upgrade-desc">Автокликеры работают в 2 раза быстрее</div>
                    <div class="premium-progress"><div class="premium-progress-bar" id="clickStormProgress" style="width: ${gameState.upgrades.clickStorm.progress}%"></div></div>
                    <button class="upgrade-btn premium" id="clickStorm" ${gameState.upgrades.clickStorm.progress >= 100 ? 'disabled' : ''}>
                        ${gameState.upgrades.clickStorm.progress >= 100 ? t.activated : `${t.upgrade} (${gameState.upgrades.clickStorm.progress}/100)`}
                    </button>
                </div>
                <div class="upgrade premium">
                    <div class="upgrade-header"><span class="upgrade-name premium">Критический удар</span><span class="upgrade-cost premium">15,000</span></div>
                    <div class="upgrade-desc">10% шанс получить 5x очков за клик</div>
                    <div class="premium-progress"><div class="premium-progress-bar" id="criticalHitProgress" style="width: ${gameState.upgrades.criticalHit.progress}%"></div></div>
                    <button class="upgrade-btn premium" id="criticalHit" ${gameState.upgrades.criticalHit.progress >= 100 ? 'disabled' : ''}>
                        ${gameState.upgrades.criticalHit.progress >= 100 ? t.activated : `${t.upgrade} (${gameState.upgrades.criticalHit.progress}/100)`}
                    </button>
                </div>
                <div class="upgrade premium">
                    <div class="upgrade-header"><span class="upgrade-name premium">Золотая лихорадка</span><span class="upgrade-cost premium">50,000</span></div>
                    <div class="upgrade-desc">Все очки увеличиваются на 25%</div>
                    <div class="premium-progress"><div class="premium-progress-bar" id="goldRushProgress" style="width: ${gameState.upgrades.goldRush.progress}%"></div></div>
                    <button class="upgrade-btn premium" id="goldRush" ${gameState.upgrades.goldRush.progress >= 100 ? 'disabled' : ''}>
                        ${gameState.upgrades.goldRush.progress >= 100 ? t.activated : `${t.upgrade} (${gameState.upgrades.goldRush.progress}/100)`}
                    </button>
                </div>
                <div class="upgrade premium">
                    <div class="upgrade-header"><span class="upgrade-name premium">Бесконечный клик</span><span class="upgrade-cost premium">100,000</span></div>
                    <div class="upgrade-desc">Автокликеры работают в 10 раз быстрее</div>
                    <div class="premium-progress"><div class="premium-progress-bar" id="infinityClickProgress" style="width: ${gameState.upgrades.infinityClick.progress}%"></div></div>
                    <button class="upgrade-btn premium" id="infinityClick" ${gameState.upgrades.infinityClick.progress >= 100 ? 'disabled' : ''}>
                        ${gameState.upgrades.infinityClick.progress >= 100 ? t.activated : `${t.upgrade} (${gameState.upgrades.infinityClick.progress}/100)`}
                    </button>
                </div>
            `;
        }
        
        function renderStats() {
            const t = translations[gameState.language];
            DOM.statsList.innerHTML = `
                <div class="stat"><span class="stat-name">${t.totalPoints}</span><span class="stat-value" id="totalPoints">${formatNumber(gameState.totalPoints)}</span></div>
                <div class="stat"><span class="stat-name">${t.totalClicks}</span><span class="stat-value" id="totalClicks">${formatNumber(gameState.totalClicks)}</span></div>
                <div class="stat"><span class="stat-name">${t.pointsFromClicks}</span><span class="stat-value" id="pointsFromClicks">${formatNumber(gameState.pointsFromClicks)}</span></div>
                <div class="stat"><span class="stat-name">${t.pointsFromAuto}</span><span class="stat-value" id="pointsFromAuto">${formatNumber(gameState.pointsFromAuto)}</span></div>
                <div class="stat"><span class="stat-name">${t.criticalHits}</span><span class="stat-value" id="criticalHits">${formatNumber(gameState.criticalHits)}</span></div>
                <div class="stat"><span class="stat-name">${t.playTime}</span><span class="stat-value" id="playTime">${Math.floor(gameState.playTime/60)}:${(gameState.playTime%60).toString().padStart(2,'0')}</span></div>
                <div class="stat"><span class="stat-name">${t.totalMultiplier}</span><span class="stat-value" id="totalMultiplier">${gameState.globalMultiplier.toFixed(1)}x</span></div>
            `;
        }
        
        function renderSettings() {
            const t = translations[gameState.language];
            DOM.settingsContent.innerHTML = `
                <div class="settings-section">
                    <h3>${t.colorTheme}</h3>
                    <div class="color-options">
                        ${Object.keys(colorSchemes).map(color => `
                            <div class="color-option ${gameState.colorScheme === color ? 'selected' : ''}" 
                                 data-color="${color}" 
                                 style="background: linear-gradient(135deg, ${colorSchemes[color].primary}, ${colorSchemes[color].secondary})">
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="settings-section">
                    <h3>${t.gameManagement}</h3>
                    <div class="stat">
                        <span class="stat-name">${t.autoSave}</span>
                        <span class="stat-value" id="lastSave">${t.never}</span>
                    </div>
                    <button class="reset-btn" id="resetProgress">${t.resetProgress}</button>
                </div>
            `;
        }
        
        function updateUI() {
            const t = translations[gameState.language];
            DOM.score.textContent = `${formatNumber(gameState.score)} ${t.points}`;
            document.getElementById('perClickStat').textContent = formatNumber(Math.floor(gameState.clickPower * gameState.globalMultiplier));
            document.getElementById('perSecondStat').textContent = formatNumber(Math.floor(gameState.autoClickers * gameState.autoClickPower * gameState.globalMultiplier));
            document.getElementById('multiplierStat').textContent = `${gameState.globalMultiplier.toFixed(1)}x`;
            
            // Обновляем доступность улучшений
            Object.keys(upgrades).forEach(id => {
                const btn = document.getElementById(id);
                if (btn) {
                    if (id in premiumUpgrades) {
                        const progress = gameState.upgrades[id].progress || 0;
                        btn.disabled = gameState.score < upgrades[id].cost || progress >= premiumUpgrades[id].maxProgress;
                    } else {
                        btn.disabled = gameState.upgrades[id].owned || gameState.score < upgrades[id].cost;
                    }
                }
            });
        }
        
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
        }
        
        // Обработчики событий
        function setupEventListeners() {
            // Табы
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab, .tab-content').forEach(el => el.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
                });
            });
            
            // Цветовые схемы
            document.addEventListener('click', e => {
                if (e.target.classList.contains('color-option')) {
                    document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('selected'));
                    e.target.classList.add('selected');
                    applyColorScheme(e.target.dataset.color);
                }
            });
            
            // Сброс прогресса
            document.addEventListener('click', e => {
                if (e.target.id === 'resetProgress') resetProgress();
            });
            
            // Основной клик
            DOM.clickButton.addEventListener('click', e => {
                createClickEffect(e);
                
                gameState.totalClicks++;
                let points = gameState.clickPower;
                
                if (gameState.upgrades.criticalHit.progress >= 100 && Math.random() < 0.1) {
                    points *= 5;
                    gameState.criticalHits++;
                    DOM.score.style.animation = 'none';
                    setTimeout(() => DOM.score.style.animation = 'bounce 0.5s', 10);
                }
                
                points = Math.floor(points * gameState.globalMultiplier);
                gameState.score += points;
                gameState.pointsFromClicks += points;
                gameState.totalPoints += points;
                
                updateUI();
                saveGame();
            });
            
            // Покупка улучшений
            document.addEventListener('click', e => {
                if (e.target.classList.contains('upgrade-btn') && !e.target.disabled) {
                    const id = e.target.id;
                    const upgrade = upgrades[id];
                    
                    if (gameState.score >= upgrade.cost) {
                        gameState.score -= upgrade.cost;
                        
                        if (id in premiumUpgrades) {
                            gameState.upgrades[id].progress++;
                            document.getElementById(`${id}Progress`).style.width = `${gameState.upgrades[id].progress}%`;
                            
                            if (gameState.upgrades[id].progress >= premiumUpgrades[id].maxProgress) {
                                upgrade.effect();
                                e.target.disabled = true;
                                e.target.textContent = translations[gameState.language].activated;
                            } else {
                                e.target.textContent = `${translations[gameState.language].upgrade} (${gameState.upgrades[id].progress}/100)`;
                            }
                        } else {
                            gameState.upgrades[id].owned = true;
                            upgrade.effect();
                            e.target.disabled = true;
                            e.target.textContent = translations[gameState.language].bought;
                        }
                        
                        updateUI();
                        saveGame();
                    }
                }
            });
        }
        
        function createClickEffect(e) {
            const effect = document.createElement('div');
            effect.className = 'click-effect';
            const x = e.clientX || e.touches?.[0]?.clientX;
            const y = e.clientY || e.touches?.[0]?.clientY;
            
            if (x && y) {
                effect.style.left = `${x}px`;
                effect.style.top = `${y}px`;
                document.body.appendChild(effect);
                setTimeout(() => effect.remove(), 800);
            }
        }
        
        // Игровые циклы
        setInterval(() => {
            if (gameState.autoClickers > 0) {
                let points = gameState.autoClickers * gameState.autoClickPower;
                points = Math.floor(points * gameState.globalMultiplier);
                if (gameState.upgrades.goldRush.progress >= 100) points = Math.floor(points * 1.25);
                
                gameState.score += points;
                gameState.pointsFromAuto += points;
                gameState.totalPoints += points;
                
                if (gameState.playTime % 10 === 0) saveGame();
                updateUI();
            }
        }, gameState.upgrades.clickStorm.progress >= 100 ? 500 : 1000);
        
        setInterval(() => {
            gameState.playTime++;
            document.getElementById('playTime').textContent = 
                `${Math.floor(gameState.playTime/60)}:${(gameState.playTime%60).toString().padStart(2,'0')}`;
        }, 1000);
        
        // Запуск игры
        initGame();
    </script>
</body>
</html>