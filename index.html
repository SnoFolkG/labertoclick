<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lä Bertō's Click</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html {
            touch-action: manipulation;
            height: 100%;
        }
        
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            transition: background-color 0.3s, color 0.3s;
            -webkit-text-size-adjust: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            text-align: center;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
        }

        :root {
            --primary: #8e44ad;
            --secondary: #9b59b6;
            --accent: #e74c3c;
            --text: #2c3e50;
            --bg: #f9f9f9;
            --premium: #f1c40f;
            --card-bg: #ffffff;
            --border: #e0e0e0;
            --stat-bg: #ffffff;
            --reset-btn: #e74c3c;
            --owned-bg: #f0f0f0;
            --owned-text: #888;
        }
        
        @media (prefers-color-scheme: dark) {
            :root {
                --text: #ecf0f1;
                --bg: #121212;
                --card-bg: #1e1e1e;
                --border: #333333;
                --stat-bg: #252525;
                --reset-btn: #c0392b;
                --owned-bg: #2a2a2a;
                --owned-text: #666;
            }
        }

        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            padding-bottom: 10px;
            -webkit-overflow-scrolling: touch;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .header h1 {
            margin: 0;
            font-size: clamp(1.5rem, 6vw, 2.2rem);
            font-weight: 700;
            font-style: italic;
            letter-spacing: 1px;
        }
        
        .tabs {
            display: flex;
            background: var(--card-bg);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 9;
        }
        
        .tab {
            flex: 1;
            padding: 12px 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: clamp(0.8rem, 3vw, 1rem);
            color: var(--text);
            position: relative;
        }
        
        .tab.active {
            color: var(--primary);
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary);
            border-radius: 3px 3px 0 0;
        }
        
        .tab-content {
            display: none;
            padding: 15px;
            flex-grow: 1;
            overflow-y: auto;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }
        
        #clickButton {
            width: clamp(120px, 40vw, 180px);
            height: clamp(120px, 40vw, 180px);
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            font-size: clamp(1rem, 4vw, 1.5rem);
            font-weight: bold;
            cursor: pointer;
            margin: 20px auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: transform 0.1s, box-shadow 0.1s;
            animation: pulse 2s infinite;
            -webkit-appearance: none;
        }
        
        #clickButton:active {
            transform: scale(0.95);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            animation: none;
        }
        
        #score {
            font-size: clamp(1.5rem, 6vw, 1.75rem);
            font-weight: bold;
            margin: 15px 0;
            color: var(--primary);
        }
        
        .upgrades-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }
        
        .upgrade {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            text-align: left;
            transition: all 0.3s;
        }
        
        .upgrade.owned {
            background: var(--owned-bg);
            opacity: 0.8;
            order: 1;
        }
        
        .upgrade.owned .upgrade-name {
            color: var(--owned-text);
        }
        
        .upgrade.owned .upgrade-desc {
            color: var(--owned-text);
        }
        
        .upgrade.owned .upgrade-btn {
            background: var(--owned-bg);
            color: var(--owned-text);
            border: 1px solid var(--owned-text);
        }
        
        .upgrade.premium {
            border: 2px solid var(--premium);
            background: linear-gradient(to bottom right, var(--card-bg), rgba(241, 196, 15, 0.1));
        }
        
        .upgrade-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .upgrade-name {
            font-weight: 600;
            font-size: clamp(0.9rem, 3.5vw, 1.1rem);
            color: var(--primary);
        }
        
        .upgrade-name.premium {
            color: var(--premium);
            animation: rainbow 3s infinite;
        }
        
        .upgrade-cost {
            background: var(--accent);
            color: white;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: clamp(0.7rem, 3vw, 0.85rem);
            font-weight: bold;
        }
        
        .upgrade-cost.premium {
            background: var(--premium);
            color: var(--text);
        }
        
        .upgrade-desc {
            color: #666;
            margin-bottom: 12px;
            font-size: clamp(0.75rem, 3vw, 0.85rem);
        }
        
        .upgrade-btn {
            width: 100%;
            padding: 8px;
            border: none;
            border-radius: 5px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: clamp(0.8rem, 3vw, 0.9rem);
            -webkit-appearance: none;
        }
        
        .upgrade-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .stats-container, .settings-container {
            background: var(--stat-bg);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            margin-top: 15px;
        }
        
        .stat {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
            font-size: clamp(0.85rem, 3vw, 1rem);
        }
        
        .stat:last-child {
            border-bottom: none;
        }
        
        .stat-name {
            font-weight: 600;
        }
        
        .stat-value {
            font-weight: bold;
            color: var(--primary);
        }
        
        .click-effect {
            position: absolute;
            width: 30px;
            height: 30px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            pointer-events: none;
            animation: clickAnimation 0.8s forwards;
            transform: translate(-50%, -50%);
        }
        
        .premium-progress {
            height: 5px;
            background: #eee;
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .premium-progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--premium), #f39c12);
            width: 0%;
            transition: width 0.3s;
        }
        
        .settings-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        
        .settings-section:last-child {
            border-bottom: none;
        }
        
        .color-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        
        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: transform 0.2s;
        }
        
        .color-option.selected {
            border: 2px solid var(--text);
            transform: scale(1.1);
        }
        
        .reset-btn, .cheat-submit {
            padding: 8px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            -webkit-appearance: none;
        }
        
        .reset-btn {
            width: 100%;
            background: var(--reset-btn);
            color: white;
            margin-top: 15px;
        }
        
        .cheat-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        
        .cheat-box {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 350px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .cheat-title {
            margin-top: 0;
            color: var(--primary);
        }
        
        .cheat-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid var(--border);
            border-radius: 5px;
            font-size: 16px;
            background: var(--bg);
            color: var(--text);
        }
        
        .cheat-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .cheat-button {
            padding: 10px;
            font-size: 18px;
            border: none;
            border-radius: 5px;
            background: var(--card-bg);
            color: var(--text);
            cursor: pointer;
        }
        
        .cheat-button:active {
            background: var(--primary);
            color: white;
        }
        
        .cheat-actions {
            display: flex;
            gap: 10px;
        }
        
        .cheat-submit {
            flex: 1;
            background: var(--primary);
            color: white;
        }
        
        .cheat-cancel {
            flex: 1;
            background: var(--reset-btn);
            color: white;
        }
        
        .special-upgrade {
            border: 2px dashed var(--primary);
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes clickAnimation {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(3); opacity: 0; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes rainbow {
            0% { color: #ff0000; }
            14% { color: #ff7f00; }
            28% { color: #ffff00; }
            42% { color: #00ff00; }
            57% { color: #0000ff; }
            71% { color: #4b0082; }
            85% { color: #9400d3; }
            100% { color: #ff0000; }
        }
        
        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        @media (max-width: 350px) {
            .upgrades-container { grid-template-columns: 1fr; }
            .tab { padding: 10px 3px; font-size: 0.7rem; }
        }
        
        @media (min-width: 768px) {
            .container { max-width: 768px; margin: 0 auto; }
            #clickButton { width: 200px; height: 200px; font-size: 1.8rem; }
            .upgrades-container { grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Lä Bertō's Click</h1>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="clicker">Кликер</div>
            <div class="tab" data-tab="upgrades">Улучшения</div>
            <div class="tab" data-tab="stats">Статистика</div>
            <div class="tab" data-tab="settings">Настройки</div>
        </div>
        
        <div class="tab-content active" id="clicker-tab">
            <div id="score">0 очков</div>
            <button id="clickButton">КЛИК!</button>
            <div class="stats-container">
                <div class="stat">
                    <span class="stat-name">Очков за клик:</span>
                    <span class="stat-value" id="perClickStat">1</span>
                </div>
                <div class="stat">
                    <span class="stat-name">Очков в секунду:</span>
                    <span class="stat-value" id="perSecondStat">0</span>
                </div>
                <div class="stat">
                    <span class="stat-name">Множитель очков:</span>
                    <span class="stat-value" id="multiplierStat">1x</span>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="upgrades-tab">
            <h2>Улучшения</h2>
            <div class="upgrades-container" id="upgradesList"></div>
        </div>
        
        <div class="tab-content" id="stats-tab">
            <h2>Статистика</h2>
            <div class="stats-container" id="statsList"></div>
        </div>
        
        <div class="tab-content" id="settings-tab">
            <h2>Настройки</h2>
            <div class="settings-container" id="settingsContent"></div>
        </div>
    </div>

    <div class="cheat-container" id="cheatContainer">
        <div class="cheat-box">
            <h3 class="cheat-title">Введите промокод</h3>
            <input type="text" class="cheat-input" id="cheatInput" placeholder="Промокод" readonly>
            <div class="cheat-buttons">
                <button class="cheat-button" data-number="1">1</button>
                <button class="cheat-button" data-number="2">2</button>
                <button class="cheat-button" data-number="3">3</button>
                <button class="cheat-button" data-number="4">4</button>
                <button class="cheat-button" data-number="5">5</button>
                <button class="cheat-button" data-number="6">6</button>
                <button class="cheat-button" data-number="7">7</button>
                <button class="cheat-button" data-number="8">8</button>
                <button class="cheat-button" data-number="9">9</button>
                <button class="cheat-button" data-number="0">0</button>
                <button class="cheat-button" id="cheatBackspace">⌫</button>
                <button class="cheat-button" id="cheatClear">C</button>
            </div>
            <div class="cheat-actions">
                <button class="cheat-submit" id="cheatSubmit">Применить</button>
                <button class="cheat-cancel" id="cheatCancel">Отмена</button>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();
        
        const translations = {
            ru: {
                clicker: "Кликер", upgrades: "Улучшения", stats: "Статистика", settings: "Настройки",
                clickButton: "КЛИК!", points: "очков", upgrade: "Улучшить", bought: "Куплено", activated: "Активировано!",
                perClick: "Очков за клик:", perSecond: "Очков в секунду:", multiplier: "Множитель очков:",
                totalPoints: "Всего очков:", totalClicks: "Всего кликов:", pointsFromClicks: "Очков с кликов:",
                pointsFromAuto: "Очков автоматически:", criticalHits: "Критических ударов:", playTime: "Время игры:",
                totalMultiplier: "Общий множитель:", settingsTitle: "Настройки", colorTheme: "Цветовая тема",
                gameManagement: "Управление игрой", resetProgress: "Сбросить прогресс", enterCheat: "Ввести промокод",
                autoSave: "Автосохранение:", never: "Никогда", cheatSuccess: "Промокод активирован!",
                cheatInvalid: "Неверный промокод", cheatUsed: "Этот промокод уже использован",
                resetConfirm: "Вы уверены, что хотите сбросить весь прогресс? Это действие нельзя отменить.",
                resetSuccess: "Прогресс успешно сброшен!"
            }
        };
        
        const colorSchemes = {
            purple: { primary: '#8e44ad', secondary: '#9b59b6', accent: '#e74c3c' },
            blue: { primary: '#3498db', secondary: '#2980b9', accent: '#e74c3c' },
            green: { primary: '#2ecc71', secondary: '#27ae60', accent: '#e74c3c' },
            red: { primary: '#e74c3c', secondary: '#c0392b', accent: '#3498db' },
            orange: { primary: '#e67e22', secondary: '#d35400', accent: '#3498db' },
            pink: { primary: '#e84393', secondary: '#fd79a8', accent: '#3498db' },
            teal: { primary: '#1abc9c', secondary: '#16a085', accent: '#e74c3c' },
            yellow: { primary: '#f1c40f', secondary: '#f39c12', accent: '#e74c3c' },
            indigo: { primary: '#9b59b6', secondary: '#8e44ad', accent: '#e74c3c' },
            cyan: { primary: '#00cec9', secondary: '#0984e3', accent: '#e74c3c' }
        };
        
        const cheats = {
            '6534': { used: false, effect: () => { gameState.score += 100000; gameState.totalPoints += 100000; } },
            '0781': { used: false, effect: () => { 
                gameState.upgrades.specialUpgrade = { owned: true };
                gameState.globalMultiplier *= 1.5;
            } }
        };
        
        const specialUpgrades = {
            specialUpgrade: { 
                name: "Секретное улучшение", 
                desc: "Увеличивает множитель очков на 50%", 
                cost: "Промокод"
            }
        };
        
        let gameState = {
            score: 0, totalClicks: 0, pointsFromClicks: 0, pointsFromAuto: 0, criticalHits: 0,
            playTime: 0, totalPoints: 0, clickPower: 1, autoClickers: 0, autoClickPower: 1,
            globalMultiplier: 1, colorScheme: 'purple', language: 'ru',
            upgrades: {
                clickPower1: { owned: false }, clickPower2: { owned: false }, clickPower3: { owned: false },
                autoClicker1: { owned: false }, autoClicker2: { owned: false }, autoClicker3: { owned: false },
                clickStorm: { progress: 0 }, criticalHit: { progress: 0 }, goldRush: { progress: 0 }, infinityClick: { progress: 0 },
                specialUpgrade: { owned: false }
            }
        };
        
        const premiumUpgrades = {
            clickStorm: { cost: 25000, maxProgress: 100, effect: () => { 
                gameState.autoClickPower *= 2; gameState.globalMultiplier *= 1.1; 
            }},
            criticalHit: { cost: 15000, maxProgress: 100, effect: () => { 
                gameState.globalMultiplier *= 1.2; 
            }},
            goldRush: { cost: 50000, maxProgress: 100, effect: () => { 
                gameState.globalMultiplier *= 1.25; 
            }},
            infinityClick: { cost: 100000, maxProgress: 100, effect: () => { 
                gameState.autoClickPower *= 10; gameState.globalMultiplier *= 1.5; 
            }}
        };
        
        const upgrades = {
            clickPower1: { cost: 100, effect: () => { gameState.clickPower += 1; } },
            clickPower2: { cost: 500, effect: () => { gameState.clickPower *= 2; } },
            clickPower3: { cost: 2500, effect: () => { gameState.clickPower *= 3; } },
            autoClicker1: { cost: 250, effect: () => { gameState.autoClickers += 1; } },
            autoClicker2: { cost: 1250, effect: () => { gameState.autoClickers += 2; } },
            autoClicker3: { cost: 6250, effect: () => { gameState.autoClickers += 5; } },
            ...premiumUpgrades
        };
        
        const DOM = {
            score: document.getElementById('score'),
            clickButton: document.getElementById('clickButton'),
            upgradesList: document.getElementById('upgradesList'),
            statsList: document.getElementById('statsList'),
            settingsContent: document.getElementById('settingsContent'),
            cheatContainer: document.getElementById('cheatContainer'),
            cheatInput: document.getElementById('cheatInput'),
            cheatSubmit: document.getElementById('cheatSubmit'),
            cheatCancel: document.getElementById('cheatCancel'),
            cheatBackspace: document.getElementById('cheatBackspace'),
            cheatClear: document.getElementById('cheatClear')
        };
        
        function initGame() {
            loadGame();
            setupEventListeners();
            renderAll();
            startGameLoop();
            
            tg.MainButton.setText("Закрыть игру");
            tg.MainButton.show();
            tg.MainButton.onClick(() => { saveGame(); tg.close(); });
        }
        
        function setupEventListeners() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
                });
            });
            
            DOM.clickButton.addEventListener('click', handleClick);
            
            document.querySelectorAll('.cheat-button[data-number]').forEach(btn => {
                btn.addEventListener('click', () => {
                    DOM.cheatInput.value += btn.dataset.number;
                });
            });
            
            DOM.cheatBackspace.addEventListener('click', () => {
                DOM.cheatInput.value = DOM.cheatInput.value.slice(0, -1);
            });
            
            DOM.cheatClear.addEventListener('click', () => {
                DOM.cheatInput.value = '';
            });
            
            DOM.cheatSubmit.addEventListener('click', () => {
                applyCheat(DOM.cheatInput.value);
            });
            
            DOM.cheatCancel.addEventListener('click', hideCheatInput);
        }
        
        function startGameLoop() {
            setInterval(() => {
                if (gameState.autoClickers > 0) {
                    const points = gameState.autoClickers * gameState.autoClickPower * gameState.globalMultiplier;
                    gameState.score += points;
                    gameState.totalPoints += points;
                    gameState.pointsFromAuto += points;
                    updateUI();
                }
            }, 1000);
            
            setInterval(() => {
                gameState.playTime++;
                saveGame();
            }, 1000);
        }
        
        function handleClick(e) {
            const clickEffect = document.createElement('div');
            clickEffect.className = 'click-effect';
            clickEffect.style.left = `${e.clientX}px`;
            clickEffect.style.top = `${e.clientY}px`;
            document.body.appendChild(clickEffect);
            
            setTimeout(() => {
                clickEffect.remove();
            }, 800);
            
            const isCritical = Math.random() < 0.1;
            const multiplier = isCritical ? 5 * gameState.globalMultiplier : gameState.globalMultiplier;
            
            const points = gameState.clickPower * multiplier;
            gameState.score += points;
            gameState.totalPoints += points;
            gameState.pointsFromClicks += points;
            gameState.totalClicks++;
            
            if (isCritical) {
                gameState.criticalHits++;
                DOM.clickButton.style.animation = 'bounce 0.3s';
                setTimeout(() => {
                    DOM.clickButton.style.animation = 'pulse 2s infinite';
                }, 300);
            }
            
            updateUI();
            saveGame();
        }
        
        function buyUpgrade(id) {
            const upgrade = upgrades[id];
            
            if (premiumUpgrades[id]) {
                if (gameState.score >= premiumUpgrades[id].cost) {
                    gameState.score -= premiumUpgrades[id].cost;
                    gameState.upgrades[id].progress++;
                    
                    if (gameState.upgrades[id].progress >= premiumUpgrades[id].maxProgress) {
                        premiumUpgrades[id].effect();
                    }
                    
                    renderUpgrades();
                    updateUI();
                    saveGame();
                }
            } else {
                if (gameState.score >= upgrade.cost && !gameState.upgrades[id].owned) {
                    gameState.score -= upgrade.cost;
                    gameState.upgrades[id].owned = true;
                    upgrade.effect();
                    
                    renderUpgrades();
                    updateUI();
                    saveGame();
                }
            }
        }
        
        function updateUI() {
            const t = translations[gameState.language];
            
            const formatNumber = (num) => {
                return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            };
            
            DOM.score.textContent = `${formatNumber(Math.floor(gameState.score))} ${t.points}`;
            
            document.getElementById('perClickStat').textContent = formatNumber(gameState.clickPower * gameState.globalMultiplier);
            document.getElementById('perSecondStat').textContent = formatNumber(gameState.autoClickers * gameState.autoClickPower * gameState.globalMultiplier);
            document.getElementById('multiplierStat').textContent = `${gameState.globalMultiplier.toFixed(1)}x`;
            
            document.querySelectorAll('.upgrade-btn').forEach(btn => {
                if (btn.id && upgrades[btn.id]) {
                    const cost = premiumUpgrades[btn.id] ? premiumUpgrades[btn.id].cost : upgrades[btn.id].cost;
                    btn.disabled = gameState.score < cost || 
                                  (gameState.upgrades[btn.id]?.progress >= premiumUpgrades[btn.id]?.maxProgress);
                }
            });
        }
        
        function renderUpgrades() {
            const t = translations[gameState.language];
            let html = '';
            
            const regularUpgrades = [
                {
                    id: 'clickPower1', name: 'Усиленный палец', cost: '100', 
                    desc: '+1 очко за каждый клик', owned: gameState.upgrades.clickPower1.owned
                },
                {
                    id: 'clickPower2', name: 'Золотой палец', cost: '500', 
                    desc: 'Удваивает очки за клик', owned: gameState.upgrades.clickPower2.owned
                },
                {
                    id: 'clickPower3', name: 'Платиновый палец', cost: '2,500', 
                    desc: 'Утраивает очки за клик', owned: gameState.upgrades.clickPower3.owned
                },
                {
                    id: 'autoClicker1', name: 'Автокликер I', cost: '250', 
                    desc: 'Автоматически кликает 1 раз в секунду', owned: gameState.upgrades.autoClicker1.owned
                },
                {
                    id: 'autoClicker2', name: 'Автокликер II', cost: '1,250', 
                    desc: 'Автоматически кликает 2 раза в секунду', owned: gameState.upgrades.autoClicker2.owned
                },
                {
                    id: 'autoClicker3', name: 'Автокликер III', cost: '6,250', 
                    desc: 'Автоматически кликает 5 раз в секунду', owned: gameState.upgrades.autoClicker3.owned
                }
            ];
            
            const premiumUpgrades = [
                {
                    id: 'clickStorm', name: 'Клик-шторм', cost: '25,000', 
                    desc: 'Автокликеры работают в 2 раза быстрее', 
                    progress: gameState.upgrades.clickStorm.progress, maxProgress: 100
                },
                {
                    id: 'criticalHit', name: 'Критический удар', cost: '15,000', 
                    desc: '10% шанс получить 5x очков за клик', 
                    progress: gameState.upgrades.criticalHit.progress, maxProgress: 100
                },
                {
                    id: 'goldRush', name: 'Золотая лихорадка', cost: '50,000', 
                    desc: 'Все очки увеличиваются на 25%', 
                    progress: gameState.upgrades.goldRush.progress, maxProgress: 100
                },
                {
                    id: 'infinityClick', name: 'Бесконечный клик', cost: '100,000', 
                    desc: 'Автокликеры работают в 10 раз быстрее', 
                    progress: gameState.upgrades.infinityClick.progress, maxProgress: 100
                }
            ];
            
            const specialUpgrades = [];
            if (gameState.upgrades.specialUpgrade.owned) {
                specialUpgrades.push({
                    id: 'specialUpgrade', name: 'Секретное улучшение', cost: 'Промокод', 
                    desc: 'Увеличивает множитель очков на 50%', owned: true
                });
            }
            
            regularUpgrades.filter(up => !up.owned).forEach(up => {
                html += `
                    <div class="upgrade">
                        <div class="upgrade-header"><span class="upgrade-name">${up.name}</span><span class="upgrade-cost">${up.cost}</span></div>
                        <div class="upgrade-desc">${up.desc}</div>
                        <button class="upgrade-btn" id="${up.id}" onclick="buyUpgrade('${up.id}')">${t.upgrade}</button>
                    </div>
                `;
            });
            
            regularUpgrades.filter(up => up.owned).forEach(up => {
                html += `
                    <div class="upgrade owned">
                        <div class="upgrade-header"><span class="upgrade-name">${up.name}</span><span class="upgrade-cost">${t.bought}</span></div>
                        <div class="upgrade-desc">${up.desc}</div>
                        <button class="upgrade-btn" disabled>${t.bought}</button>
                    </div>
                `;
            });
            
            premiumUpgrades.forEach(up => {
                const progress = (up.progress / up.maxProgress) * 100;
                const canBuy = gameState.score >= parseInt(up.cost.replace(/,/g, '')) && up.progress < up.maxProgress;
                
                html += `
                    <div class="upgrade premium">
                        <div class="upgrade-header">
                            <span class="upgrade-name premium">${up.name}</span>
                            <span class="upgrade-cost premium">${up.cost}</span>
                        </div>
                        <div class="upgrade-desc">${up.desc}</div>
                        <div class="premium-progress">
                            <div class="premium-progress-bar" style="width: ${progress}%"></div>
                        </div>
                        <button class="upgrade-btn" id="${up.id}" onclick="buyUpgrade('${up.                id}')" ${canBuy ? '' : 'disabled'}>
                            ${up.progress < up.maxProgress ? t.upgrade : t.activated}
                        </button>
                    </div>
                `;
            });

            specialUpgrades.forEach(up => {
                html += `
                    <div class="upgrade special-upgrade">
                        <div class="upgrade-header">
                            <span class="upgrade-name">${up.name}</span>
                            <span class="upgrade-cost">${up.cost}</span>
                        </div>
                        <div class="upgrade-desc">${up.desc}</div>
                        <button class="upgrade-btn" disabled>${t.activated}</button>
                    </div>
                `;
            });

            DOM.upgradesList.innerHTML = html;
        }

        function renderStats() {
            const t = translations[gameState.language];
            
            const formatTime = (seconds) => {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = seconds % 60;
                return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            };
            
            const stats = [
                { name: t.totalPoints, value: Math.floor(gameState.totalPoints) },
                { name: t.totalClicks, value: gameState.totalClicks },
                { name: t.pointsFromClicks, value: Math.floor(gameState.pointsFromClicks) },
                { name: t.pointsFromAuto, value: Math.floor(gameState.pointsFromAuto) },
                { name: t.criticalHits, value: gameState.criticalHits },
                { name: t.playTime, value: formatTime(gameState.playTime) },
                { name: t.totalMultiplier, value: `${gameState.globalMultiplier.toFixed(1)}x` }
            ];
            
            let html = '';
            stats.forEach(stat => {
                html += `
                    <div class="stat">
                        <span class="stat-name">${stat.name}</span>
                        <span class="stat-value">${stat.value}</span>
                    </div>
                `;
            });
            
            DOM.statsList.innerHTML = html;
        }

        function renderSettings() {
            const t = translations[gameState.language];
            
            let html = `
                <div class="settings-section">
                    <h3>${t.colorTheme}</h3>
                    <div class="color-options">
            `;
            
            Object.keys(colorSchemes).forEach(scheme => {
                html += `
                    <div class="color-option ${gameState.colorScheme === scheme ? 'selected' : ''}" 
                          style="background: ${colorSchemes[scheme].primary}"
                          onclick="changeColorScheme('${scheme}')"></div>
                `;
            });
            
            html += `
                    </div>
                </div>
                <div class="settings-section">
                    <h3>${t.gameManagement}</h3>
                    <button class="reset-btn" onclick="resetProgress()">${t.resetProgress}</button>
                    <button class="reset-btn" onclick="showCheatInput()" style="margin-top: 10px">${t.enterCheat}</button>
                </div>
            `;
            
            DOM.settingsContent.innerHTML = html;
        }

        function renderAll() {
            updateUI();
            renderUpgrades();
            renderStats();
            renderSettings();
            applyColorScheme();
        }

        function changeColorScheme(scheme) {
            gameState.colorScheme = scheme;
            applyColorScheme();
            renderSettings();
            saveGame();
        }

        function applyColorScheme() {
            const scheme = colorSchemes[gameState.colorScheme];
            document.documentElement.style.setProperty('--primary', scheme.primary);
            document.documentElement.style.setProperty('--secondary', scheme.secondary);
            document.documentElement.style.setProperty('--accent', scheme.accent);
        }

        function showCheatInput() {
            DOM.cheatContainer.style.display = 'flex';
            DOM.cheatInput.value = '';
        }

        function hideCheatInput() {
            DOM.cheatContainer.style.display = 'none';
        }

        function applyCheat(code) {
            const t = translations[gameState.language];
            
            if (cheats[code]) {
                if (cheats[code].used) {
                    alert(t.cheatUsed);
                } else {
                    cheats[code].used = true;
                    cheats[code].effect();
                    alert(t.cheatSuccess);
                    renderAll();
                    saveGame();
                }
            } else {
                alert(t.cheatInvalid);
            }
            
            hideCheatInput();
        }

        function resetProgress() {
            const t = translations[gameState.language];
            
            if (confirm(t.resetConfirm)) {
                gameState = {
                    score: 0, totalClicks: 0, pointsFromClicks: 0, pointsFromAuto: 0, criticalHits: 0,
                    playTime: 0, totalPoints: 0, clickPower: 1, autoClickers: 0, autoClickPower: 1,
                    globalMultiplier: 1, colorScheme: gameState.colorScheme, language: 'ru',
                    upgrades: {
                        clickPower1: { owned: false }, clickPower2: { owned: false }, clickPower3: { owned: false },
                        autoClicker1: { owned: false }, autoClicker2: { owned: false }, autoClicker3: { owned: false },
                        clickStorm: { progress: 0 }, criticalHit: { progress: 0 }, goldRush: { progress: 0 }, 
                        infinityClick: { progress: 0 }, specialUpgrade: { owned: false }
                    }
                };
                
                Object.keys(cheats).forEach(code => {
                    cheats[code].used = false;
                });
                
                renderAll();
                saveGame();
                alert(t.resetSuccess);
            }
        }

        function saveGame() {
            localStorage.setItem('laBertosClick', JSON.stringify(gameState));
        }

        function loadGame() {
            const saved = localStorage.getItem('laBertosClick');
            if (saved) {
                const loaded = JSON.parse(saved);
                
                // Merge loaded state with default state to ensure all properties exist
                gameState = {
                    ...gameState,
                    ...loaded,
                    upgrades: {
                        ...gameState.upgrades,
                        ...(loaded.upgrades || {})
                    }
                };
            }
        }

        // Initialize the game when the page loads
        window.onload = initGame;
        
        // Expose functions to global scope for HTML onclick handlers
        window.buyUpgrade = buyUpgrade;
        window.changeColorScheme = changeColorScheme;
        window.resetProgress = resetProgress;
        window.showCheatInput = showCheatInput;
    </script>
</body>
</html>
